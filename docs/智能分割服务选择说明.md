# 智能分割服务选择说明

## 功能概述

系统会根据场景类型自动选择最合适的图像分割服务，以获得最佳的分割效果。

## 选择规则

### 1. 商品场景 → 商品分割 (SegmentCommodity)

**触发条件：**
- `sceneType` 为 `taobao` 或 `amazon`

**优势：**
- 针对商品图片优化
- 分割精度更高
- 边缘更清晰
- QPS 阈值：5

**适用场景：**
- 淘宝商品图
- 亚马逊商品图
- 电商产品图

### 2. 其他场景 → 通用分割 (SegmentCommonImage)

**触发条件：**
- `sceneType` 为 `douyin`、`xiaohongshu`、`custom` 或其他
- 未指定 `sceneType`

**优势：**
- 通用性强
- 支持各种图片类型
- QPS 阈值：5

**适用场景：**
- 抖音视频封面
- 小红书配图
- 自定义场景
- 通用图片

## 使用方式

### 方式一：通过场景类型自动选择

在图片处理请求中指定 `sceneType`：

```json
{
  "imageId": "img_abc123",
  "operations": [
    {
      "type": "cutout",
      "params": {}
    }
  ],
  "sceneType": "taobao"  // 自动使用商品分割
}
```

### 方式二：上传时指定场景类型

在图片上传时指定场景类型，处理时会自动使用：

```bash
curl -X POST "http://localhost:8000/v1/images/upload" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "files=@product.jpg" \
  -F "sceneType=taobao"
```

## 降级机制

如果指定的分割服务调用失败，系统会自动降级：

1. **商品分割失败** → 自动降级到通用分割
2. **通用分割失败** → 返回错误

## 日志说明

系统会记录选择的分割服务：

```
DEBUG - 根据场景类型 taobao 选择商品分割服务
DEBUG - 使用商品分割服务
```

或

```
DEBUG - 根据场景类型 douyin 使用通用分割服务
DEBUG - 使用通用分割服务
```

## 性能对比

| 服务 | 商品图片精度 | 人像图片精度 | 通用图片精度 | QPS |
|------|------------|------------|------------|-----|
| 商品分割 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ | 5 |
| 通用分割 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 5 |

## 最佳实践

1. **商品图片**：始终使用 `sceneType: "taobao"` 或 `"amazon"`
2. **人像图片**：使用 `sceneType: "douyin"` 或 `"xiaohongshu"`（通用分割）
3. **不确定类型**：不指定 `sceneType`，使用通用分割

## 未来增强

后续可以增强为：
- 使用通义千问 VL 自动分析图片类型
- 根据图片内容智能选择（商品/人像/场景）
- 支持更多专业分割服务（人体分割、食品分割等）

